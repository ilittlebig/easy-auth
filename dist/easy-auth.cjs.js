"use strict";var Me=Object.defineProperty;var _e=(t,e,n)=>e in t?Me(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var p=(t,e,n)=>_e(t,typeof e!="symbol"?e+"":e,n);Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const h=require("@aws-sdk/client-cognito-identity-provider"),T=require("sjcl-aws");class C extends Error{constructor({message:e,name:n}){super(e),this.name=n}}class me{constructor(){p(this,"storage",new Map)}get length(){return this.storage.size}key(e){return e>this.length-1?null:Array.from(this.storage.keys())[e]}getItem(e){return this.storage.get(e)??null}setItem(e,n){this.storage.set(e,n)}removeItem(e){this.storage.delete(e)}clear(){this.storage.clear()}}const be=()=>{try{if(typeof window<"u"&&window.localStorage)return window.localStorage}catch{console.log("localStorage not found, using inMemoryStorage as fallback")}return new me};class fe{constructor(){p(this,"storage");this.storage=be()}getItem(e){return this.storage.getItem(e)}setItem(e,n){this.storage.setItem(e,n)}removeItem(e){this.storage.removeItem(e)}clear(){this.storage.clear()}}/*! js-cookie v3.0.5 | MIT */function $(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var o in n)t[o]=n[o]}return t}var Be={read:function(t){return t[0]==='"'&&(t=t.slice(1,-1)),t.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(t){return encodeURIComponent(t).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}};function j(t,e){function n(s,i,r){if(!(typeof document>"u")){r=$({},e,r),typeof r.expires=="number"&&(r.expires=new Date(Date.now()+r.expires*864e5)),r.expires&&(r.expires=r.expires.toUTCString()),s=encodeURIComponent(s).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var a="";for(var c in r)r[c]&&(a+="; "+c,r[c]!==!0&&(a+="="+r[c].split(";")[0]));return document.cookie=s+"="+t.write(i,s)+a}}function o(s){if(!(typeof document>"u"||arguments.length&&!s)){for(var i=document.cookie?document.cookie.split("; "):[],r={},a=0;a<i.length;a++){var c=i[a].split("="),l=c.slice(1).join("=");try{var d=decodeURIComponent(c[0]);if(r[d]=t.read(l,d),s===d)break}catch{}}return s?r[s]:r}}return Object.create({set:n,get:o,remove:function(s,i){n(s,"",$({},i,{expires:-1}))},withAttributes:function(s){return j(this.converter,$({},this.attributes,s))},withConverter:function(s){return j($({},this.converter,s),this.attributes)}},{attributes:{value:Object.freeze(e)},converter:{value:Object.freeze(t)}})}var W=j(Be,{path:"/"});class Oe{constructor(){p(this,"listeners");this.listeners=new Map}_remove(e,n){const o=this.listeners.get(e);if(!o){console.log(`No listeners for ${e}`);return}this.listeners.set(e,o.filter(({callback:s})=>s!==n))}dispatch(e,n){const o={channel:e,payload:{...n},patternInfo:[]};try{this._toListeners(o)}catch(s){console.log("dispatch error:",s)}}listen(e,n,o="noname"){if(typeof n!="function")return()=>{};let s=this.listeners.get(e);return s||(s=[],this.listeners.set(e,s)),s.push({name:o,callback:n}),()=>this._remove(e,n)}_toListeners(e){const{channel:n}=e,o=this.listeners.get(n);o&&o.forEach(s=>{try{s.callback(e)}catch(i){console.log("_toListeners error:",i)}})}}const Y=new Oe,B=t=>{const e=t.split(".");if(e.length!==3)throw new C({name:"InvalidJWTTokenException",message:m.InvalidJWTTokenException});try{const o=e[1].replace(/-/g,"+").replace(/_/g,"/"),s=atob(o),i=decodeURIComponent(s.split("").map(a=>"%"+("00"+a.charCodeAt(0).toString(16)).slice(-2)).join("")),r=JSON.parse(i);return{toString:()=>t,payload:r}}catch(n){throw new C({name:"InvalidJWTTokenException",message:m.InvalidJWTTokenPayloadException+": "+n.message})}},pe="CognitoIdentityServiceProvider",Ve=(t,e)=>Ke({accessToken:"accessToken",idToken:"idToken",clockDrift:"clockDrift",refreshToken:"refreshToken",deviceKey:"deviceKey",deviceGroupKey:"deviceGroupKey",randomPassword:"randomPassword",signInDetails:"signInDetails"})(`${t}`,e),Ke=t=>{const e=Object.values(t);return(n,o)=>e.reduce((s,i)=>({...s,[i]:`${n}${o?`.${o}`:""}.${i}`}),{})},Q=()=>{var n;const t=(n=v.getConfig().Auth)==null?void 0:n.Cognito,{userPoolClientId:e}=t;return`${pe}.${e}.LastAuthUser`},X=()=>{const t=O(),e=Q();return t.getItem(e)??"username"},H=t=>{var s;const e=(s=v.getConfig().Auth)==null?void 0:s.Cognito,{userPoolClientId:n}=e,o=t??X();return Ve(pe,`${n}.${o}`)},O=()=>v.keyValueStorage,b=(t,e)=>{if(!e)return;O().setItem(t,e.toString())},$e=(t,e)=>{if(!e)return;O().setItem(t,JSON.stringify(e))},We=(t,e,n=b)=>{if(!e)return;const{deviceKey:o,deviceGroupKey:s,randomPassword:i}=e;n(t.deviceKey,o),n(t.deviceGroupKey,s),n(t.randomPassword,i)},ee=async()=>{const t=H(),e=Q(),n=O();await Promise.all([n.removeItem(t.accessToken),n.removeItem(t.idToken),n.removeItem(t.clockDrift),n.removeItem(t.refreshToken),n.removeItem(t.signInDetails),n.removeItem(e)])},He=t=>{if(!t)throw new C({name:"InvalidAuthTokensException",message:m.InvalidAuthTokensException});ee();const{accessToken:e,idToken:n,refreshToken:o,deviceMetadata:s,clockDrift:i,signInDetails:r}=t,a=t.username;b(Q(),a);const c=H();b(c.accessToken,e.toString()),b(c.idToken,n==null?void 0:n.toString()),b(c.refreshToken,o==null?void 0:o.toString()),We(c,s,b),$e(c.signInDetails,r),b(c.clockDrift,`${i}`)},Ce=({username:t,authenticationResult:e,newDeviceMetadata:n,signInDetails:o})=>{if(!e.AccessToken)throw new C({name:"NoAccessTokenException",message:m.NoAccessTokenException});const s=B(e.AccessToken),i=(s.payload.iat||0)*1e3,r=new Date().getTime(),a=i>0?i-r:0;let c,l,d=n;e.RefreshToken&&(l=e.RefreshToken),e.IdToken&&(c=B(e.IdToken)),He({accessToken:s,idToken:c,refreshToken:l,clockDrift:a,deviceMetadata:d,username:t,signInDetails:o})},Ge=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],Le=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],qe="Caldera Derived Key",Ze="89ABCDEFabcdef",q=t=>t<10?`0${t}`:t,Se=()=>{const t=new Date,e=Ge[t.getUTCDay()],n=Le[t.getUTCMonth()],o=t.getUTCDate(),s=q(t.getUTCHours()),i=q(t.getUTCMinutes()),r=q(t.getUTCSeconds()),a=t.getUTCFullYear();return`${e} ${n} ${o} ${s}:${i}:${r} UTC ${a}`},Ee=(t,e,n,o,s)=>{try{const i=new T.misc.hmac(t);return i.update(T.codec.utf8String.toBits(e)),i.update(T.codec.utf8String.toBits(n)),i.update(T.codec.base64.toBits(o)),i.update(T.codec.utf8String.toBits(s)),T.codec.base64.fromBits(i.digest())}catch{throw new Error("Failed to calculate signature due to invalid input.")}},_=t=>{let e=t.toString(16);const n=e.length%2,o=Ze.indexOf(e[0]);return n===1?e=`0${e}`:o!==-1&&(e=`00${e}`),e},z=t=>{const e=T.codec.hex.fromBits(T.hash.sha256.hash(t));return`${new Array(64-e.length).join("0")}${e}`},Z=t=>z(T.codec.hex.toBits(t)),Je=(t,e)=>T.misc.hkdf(T.codec.hex.toBits(t),128,T.codec.hex.toBits(e),qe),Te=t=>{const e=Math.ceil(t/4);return T.random.randomWords(e,0)},je=()=>{const t=Te(40);return T.codec.base64.fromBits(t)},ze=t=>T.codec.hex.fromBits(t),Ye=t=>{const e=T.codec.hex.toBits(t),n=T.hash.sha256.hash(e);return T.codec.hex.fromBits(n)},ae=t=>{const e=T.codec.hex.toBits(t);return T.codec.base64.fromBits(e)};function u(t,e){t!=null&&this.fromString(t,e)}function P(){return new u(null)}var F,Qe=0xdeadbeefcafe,ce=(Qe&16777215)==15715070;function Xe(t,e,n,o,s,i){for(;--i>=0;){var r=e*this[t++]+n[o]+s;s=Math.floor(r/67108864),n[o++]=r&67108863}return s}function et(t,e,n,o,s,i){for(var r=e&32767,a=e>>15;--i>=0;){var c=this[t]&32767,l=this[t++]>>15,d=a*c+l*r;c=r*c+((d&32767)<<15)+n[o]+(s&1073741823),s=(c>>>30)+(d>>>15)+a*l+(s>>>30),n[o++]=c&1073741823}return s}function tt(t,e,n,o,s,i){for(var r=e&16383,a=e>>14;--i>=0;){var c=this[t]&16383,l=this[t++]>>14,d=a*c+l*r;c=r*c+((d&16383)<<14)+n[o]+s,s=(c>>28)+(d>>14)+a*l,n[o++]=c&268435455}return s}var le=typeof navigator<"u";le&&ce&&navigator.appName=="Microsoft Internet Explorer"?(u.prototype.am=et,F=30):le&&ce&&navigator.appName!="Netscape"?(u.prototype.am=Xe,F=26):(u.prototype.am=tt,F=28);u.prototype.DB=F;u.prototype.DM=(1<<F)-1;u.prototype.DV=1<<F;var te=52;u.prototype.FV=Math.pow(2,te);u.prototype.F1=te-F;u.prototype.F2=2*F-te;var nt="0123456789abcdefghijklmnopqrstuvwxyz",G=[],V,U;V=48;for(U=0;U<=9;++U)G[V++]=U;V=97;for(U=10;U<36;++U)G[V++]=U;V=65;for(U=10;U<36;++U)G[V++]=U;function de(t){return nt.charAt(t)}function ot(t,e){var n=G[t.charCodeAt(e)];return n??-1}function st(t){for(var e=this.t-1;e>=0;--e)t[e]=this[e];t.t=this.t,t.s=this.s}function it(t){this.t=1,this.s=t<0?-1:0,t>0?this[0]=t:t<-1?this[0]=t+this.DV:this.t=0}function ne(t){var e=P();return e.fromInt(t),e}function rt(t,e){var n;if(e==16)n=4;else if(e==8)n=3;else if(e==2)n=1;else if(e==32)n=5;else if(e==4)n=2;else throw new Error("Only radix 2, 4, 8, 16, 32 are supported");this.t=0,this.s=0;for(var o=t.length,s=!1,i=0;--o>=0;){var r=ot(t,o);if(r<0){t.charAt(o)=="-"&&(s=!0);continue}s=!1,i==0?this[this.t++]=r:i+n>this.DB?(this[this.t-1]|=(r&(1<<this.DB-i)-1)<<i,this[this.t++]=r>>this.DB-i):this[this.t-1]|=r<<i,i+=n,i>=this.DB&&(i-=this.DB)}this.clamp(),s&&u.ZERO.subTo(this,this)}function at(){for(var t=this.s&this.DM;this.t>0&&this[this.t-1]==t;)--this.t}function ct(t){if(this.s<0)return"-"+this.negate().toString(t);var e;if(t==16)e=4;else if(t==8)e=3;else if(t==2)e=1;else if(t==32)e=5;else if(t==4)e=2;else throw new Error("Only radix 2, 4, 8, 16, 32 are supported");var n=(1<<e)-1,o,s=!1,i="",r=this.t,a=this.DB-r*this.DB%e;if(r-- >0)for(a<this.DB&&(o=this[r]>>a)>0&&(s=!0,i=de(o));r>=0;)a<e?(o=(this[r]&(1<<a)-1)<<e-a,o|=this[--r]>>(a+=this.DB-e)):(o=this[r]>>(a-=e)&n,a<=0&&(a+=this.DB,--r)),o>0&&(s=!0),s&&(i+=de(o));return s?i:"0"}function lt(){var t=P();return u.ZERO.subTo(this,t),t}function dt(){return this.s<0?this.negate():this}function ut(t){var e=this.s-t.s;if(e!=0)return e;var n=this.t;if(e=n-t.t,e!=0)return this.s<0?-e:e;for(;--n>=0;)if((e=this[n]-t[n])!=0)return e;return 0}function oe(t){var e=1,n;return(n=t>>>16)!=0&&(t=n,e+=16),(n=t>>8)!=0&&(t=n,e+=8),(n=t>>4)!=0&&(t=n,e+=4),(n=t>>2)!=0&&(t=n,e+=2),(n=t>>1)!=0&&(t=n,e+=1),e}function ht(){return this.t<=0?0:this.DB*(this.t-1)+oe(this[this.t-1]^this.s&this.DM)}function gt(t,e){var n;for(n=this.t-1;n>=0;--n)e[n+t]=this[n];for(n=t-1;n>=0;--n)e[n]=0;e.t=this.t+t,e.s=this.s}function mt(t,e){for(var n=t;n<this.t;++n)e[n-t]=this[n];e.t=Math.max(this.t-t,0),e.s=this.s}function ft(t,e){var n=t%this.DB,o=this.DB-n,s=(1<<o)-1,i=Math.floor(t/this.DB),r=this.s<<n&this.DM,a;for(a=this.t-1;a>=0;--a)e[a+i+1]=this[a]>>o|r,r=(this[a]&s)<<n;for(a=i-1;a>=0;--a)e[a]=0;e[i]=r,e.t=this.t+i+1,e.s=this.s,e.clamp()}function pt(t,e){e.s=this.s;var n=Math.floor(t/this.DB);if(n>=this.t){e.t=0;return}var o=t%this.DB,s=this.DB-o,i=(1<<o)-1;e[0]=this[n]>>o;for(var r=n+1;r<this.t;++r)e[r-n-1]|=(this[r]&i)<<s,e[r-n]=this[r]>>o;o>0&&(e[this.t-n-1]|=(this.s&i)<<s),e.t=this.t-n,e.clamp()}function Ct(t,e){for(var n=0,o=0,s=Math.min(t.t,this.t);n<s;)o+=this[n]-t[n],e[n++]=o&this.DM,o>>=this.DB;if(t.t<this.t){for(o-=t.s;n<this.t;)o+=this[n],e[n++]=o&this.DM,o>>=this.DB;o+=this.s}else{for(o+=this.s;n<t.t;)o-=t[n],e[n++]=o&this.DM,o>>=this.DB;o-=t.s}e.s=o<0?-1:0,o<-1?e[n++]=this.DV+o:o>0&&(e[n++]=o),e.t=n,e.clamp()}function St(t,e){var n=this.abs(),o=t.abs(),s=n.t;for(e.t=s+o.t;--s>=0;)e[s]=0;for(s=0;s<o.t;++s)e[s+n.t]=n.am(0,o[s],e,s,0,n.t);e.s=0,e.clamp(),this.s!=t.s&&u.ZERO.subTo(e,e)}function Et(t){for(var e=this.abs(),n=t.t=2*e.t;--n>=0;)t[n]=0;for(n=0;n<e.t-1;++n){var o=e.am(n,e[n],t,2*n,0,1);(t[n+e.t]+=e.am(n+1,2*e[n],t,2*n+1,o,e.t-n-1))>=e.DV&&(t[n+e.t]-=e.DV,t[n+e.t+1]=1)}t.t>0&&(t[t.t-1]+=e.am(n,e[n],t,2*n,0,1)),t.s=0,t.clamp()}function Tt(t,e,n){var o=t.abs();if(!(o.t<=0)){var s=this.abs();if(s.t<o.t){e!=null&&e.fromInt(0),n!=null&&this.copyTo(n);return}n==null&&(n=P());var i=P(),r=this.s,a=t.s,c=this.DB-oe(o[o.t-1]);c>0?(o.lShiftTo(c,i),s.lShiftTo(c,n)):(o.copyTo(i),s.copyTo(n));var l=i.t,d=i[l-1];if(d!=0){var g=d*(1<<this.F1)+(l>1?i[l-2]>>this.F2:0),f=this.FV/g,E=(1<<this.F1)/g,I=1<<this.F2,S=n.t,y=S-l,A=e??P();for(i.dlShiftTo(y,A),n.compareTo(A)>=0&&(n[n.t++]=1,n.subTo(A,n)),u.ONE.dlShiftTo(l,A),A.subTo(i,i);i.t<l;)i[i.t++]=0;for(;--y>=0;){var N=n[--S]==d?this.DM:Math.floor(n[S]*f+(n[S-1]+I)*E);if((n[S]+=i.am(0,N,n,y,0,l))<N)for(i.dlShiftTo(y,A),n.subTo(A,n);n[S]<--N;)n.subTo(A,n)}e!=null&&(n.drShiftTo(l,e),r!=a&&u.ZERO.subTo(e,e)),n.t=l,n.clamp(),c>0&&n.rShiftTo(c,n),r<0&&u.ZERO.subTo(n,n)}}}function wt(t){var e=P();return this.abs().divRemTo(t,null,e),this.s<0&&e.compareTo(u.ZERO)>0&&t.subTo(e,e),e}function vt(){if(this.t<1)return 0;var t=this[0];if(!(t&1))return 0;var e=t&3;return e=e*(2-(t&15)*e)&15,e=e*(2-(t&255)*e)&255,e=e*(2-((t&65535)*e&65535))&65535,e=e*(2-t*e%this.DV)%this.DV,e>0?this.DV-e:-e}function yt(t){return this.compareTo(t)==0}function At(t,e){for(var n=0,o=0,s=Math.min(t.t,this.t);n<s;)o+=this[n]+t[n],e[n++]=o&this.DM,o>>=this.DB;if(t.t<this.t){for(o+=t.s;n<this.t;)o+=this[n],e[n++]=o&this.DM,o>>=this.DB;o+=this.s}else{for(o+=this.s;n<t.t;)o+=t[n],e[n++]=o&this.DM,o>>=this.DB;o+=t.s}e.s=o<0?-1:0,o>0?e[n++]=o:o<-1&&(e[n++]=this.DV+o),e.t=n,e.clamp()}function It(t){var e=P();return this.addTo(t,e),e}function Pt(t){var e=P();return this.subTo(t,e),e}function Dt(t){var e=P();return this.multiplyTo(t,e),e}function Ut(t){var e=P();return this.divRemTo(t,e,null),e}function K(t){this.m=t,this.mp=t.invDigit(),this.mpl=this.mp&32767,this.mph=this.mp>>15,this.um=(1<<t.DB-15)-1,this.mt2=2*t.t}function xt(t){var e=P();return t.abs().dlShiftTo(this.m.t,e),e.divRemTo(this.m,null,e),t.s<0&&e.compareTo(u.ZERO)>0&&this.m.subTo(e,e),e}function Rt(t){var e=P();return t.copyTo(e),this.reduce(e),e}function Nt(t){for(;t.t<=this.mt2;)t[t.t++]=0;for(var e=0;e<this.m.t;++e){var n=t[e]&32767,o=n*this.mpl+((n*this.mph+(t[e]>>15)*this.mpl&this.um)<<15)&t.DM;for(n=e+this.m.t,t[n]+=this.m.am(0,o,t,e,0,this.m.t);t[n]>=t.DV;)t[n]-=t.DV,t[++n]++}t.clamp(),t.drShiftTo(this.m.t,t),t.compareTo(this.m)>=0&&t.subTo(this.m,t)}function kt(t,e){t.squareTo(e),this.reduce(e)}function Ft(t,e,n){t.multiplyTo(e,n),this.reduce(n)}K.prototype.convert=xt;K.prototype.revert=Rt;K.prototype.reduce=Nt;K.prototype.mulTo=Ft;K.prototype.sqrTo=kt;function Mt(t,e,n){var o=t.bitLength(),s=ne(1),i=new K(e),r;if(o<=0)return s;o<18?r=1:o<48?r=3:o<144?r=4:o<768?r=5:r=6;var a=[],c=r-1,l=(1<<r)-1,d=3;if(a[1]=i.convert(this),r>1){var g=P();for(i.sqrTo(a[1],g);d<=l;)a[d]=P(),i.mulTo(g,a[d-2],a[d]),d+=2}var f=t.t-1,E,I=!0,S=P(),y;for(o=oe(t[f])-1;f>=0;){for(o>=c?E=t[f]>>o-c&l:(E=(t[f]&(1<<o+1)-1)<<c-o,f>0&&(E|=t[f-1]>>this.DB+o-c)),d=r;!(E&1);)E>>=1,--d;if((o-=d)<0&&(o+=this.DB,--f),I)a[E].copyTo(s),I=!1;else{for(;d>1;)i.sqrTo(s,S),i.sqrTo(S,s),d-=2;d>0?i.sqrTo(s,S):(y=s,s=S,S=y),i.mulTo(S,a[E],s)}for(;f>=0&&!(t[f]&1<<o);)i.sqrTo(s,S),y=s,s=S,S=y,--o<0&&(o=this.DB-1,--f)}var A=i.revert(s);return n&&n(null,A),A}function _t(){return this.compareTo(u.ZERO)==0}u.prototype.copyTo=st;u.prototype.fromInt=it;u.prototype.fromString=rt;u.prototype.clamp=at;u.prototype.dlShiftTo=gt;u.prototype.drShiftTo=mt;u.prototype.lShiftTo=ft;u.prototype.rShiftTo=pt;u.prototype.subTo=Ct;u.prototype.multiplyTo=St;u.prototype.squareTo=Et;u.prototype.divRemTo=Tt;u.prototype.invDigit=vt;u.prototype.addTo=At;u.prototype.toString=ct;u.prototype.abs=dt;u.prototype.negate=lt;u.prototype.compareTo=ut;u.prototype.bitLength=ht;u.prototype.mod=wt;u.prototype.equals=yt;u.prototype.add=It;u.prototype.subtract=Pt;u.prototype.multiply=Dt;u.prototype.divide=Ut;u.prototype.modPow=Mt;u.prototype.isZero=_t;u.ZERO=ne(0);u.ONE=ne(1);var x=function(t,e){return new u(t,e)};const bt="FFFFFFFFFFFFFFFFC90FDAA22168C234C4C6628B80DC1CD129024E088A67CC74020BBEA63B139B22514A08798E3404DDEF9519B3CD3A431B302B0A6DF25F14374FE1356D6D51C245E485B576625E7EC6F44C42E9A637ED6B0BFF5CB6F406B7EDEE386BFB5A899FA5AE9F24117C4B1FE649286651ECE45B3DC2007CB8A163BF0598DA48361C55D39A69163FA8FD24CF5F83655D23DCA3AD961C62F356208552BB9ED529077096966D670C354E4ABC9804F1746C08CA18217C32905E462E36CE3BE39E772C180E86039B2783A2EC07A28FB5C55DF06F4C52C9DE2BCBF6955817183995497CEA956AE515D2261898FA051015728E5A8AAAC42DAD33170D04507A33A85521ABDF1CBA64ECFB850458DBEF0A8AEA71575D060C7DB3970F85A6E1E4C7ABF5AE8CDB0933D71E8C94E04A25619DCEE3D2261AD2EE6BF12FFA06D98A0864D87602733EC86A64521F2B18177B200CBBE117577A615D6C770988C0BAD946E208E24FA074E5AB3143DB5BFCE0FD108E4B82D120A93AD2CAFFFFFFFFFFFFFFFF";class se{constructor(e){p(this,"poolName");p(this,"N");p(this,"g");p(this,"k");p(this,"saltToHashDevices");p(this,"verifierDevices");p(this,"randomPassword");p(this,"smallAValue");p(this,"largeAValue");p(this,"UValue");p(this,"generateRandomSmallA",()=>{if(this.smallAValue=x(T.codec.hex.fromBits(T.random.randomWords(8,0)),16).mod(this.N),!this.smallAValue)throw new Error("Failed to generate smallAValue");return this.smallAValue.toString(16)});p(this,"calculateA",(e=this.generateRandomSmallA())=>{if(this.largeAValue=this.g.modPow(x(e,16),this.N),this.largeAValue.mod(this.N).isZero())throw new Error("Illegal parameter. A mod N cannot be 0.");return this.largeAValue.toString(16)});p(this,"calculateU",(e,n)=>x(Z(`${_(e)}${_(n)}`),16));p(this,"getPasswordAuthenticationKey",(e,n,o,s)=>{let i=x(o,16),r=x(s,16);if(i.mod(this.N).isZero())throw new Error("B cannot be zero.");if(!this.largeAValue)throw new Error("largeAValue is undefined");if(this.UValue=this.calculateU(this.largeAValue,i),this.UValue.isZero())throw new Error("U cannot be zero.");const l=`${this.poolName}${e}:${n}`,d=z(l),g=`${_(r)}${d}`,f=x(Z(g),16),E=this.g.modPow(f,this.N),I=i.subtract(this.k.multiply(E));if(!this.smallAValue)throw new Error("smallAValue is undefined");const S=this.UValue.multiply(f),y=I.modPow(this.smallAValue.add(S),this.N).mod(this.N);return Je(_(y),_(this.UValue))});p(this,"generateHashDevice",(e,n)=>{this.randomPassword=je();const o=`${e}${n}:${this.randomPassword}`,s=z(o),i=Te(16),r=ze(i);return this.saltToHashDevices=_(x(r,16)),new Promise((a,c)=>{(async()=>{try{const l=Ye(this.saltToHashDevices+s),d=x(l,16),g=this.g.modPow(d,this.N);this.verifierDevices=_(g)}catch(l){c(l)}})()})});this.poolName=e,this.N=x(bt,16),this.g=x("2",16),this.k=x(Z(`00${this.N.toString(16)}0${this.g.toString(16)}`),16),this.saltToHashDevices="",this.verifierDevices="",this.randomPassword=""}}const ue=()=>{throw new C({name:"InvalidUserPoolIdException",message:m.InvalidUserPoolIdException})},we=t=>{(typeof t!="string"||!t.includes("_"))&&ue();const e=t.split("_").map(n=>n.trim());return(e.length!==2||e[0]===""||e[1]==="")&&ue(),e},w=t=>{const[e]=we(t);return e},ie=t=>{const[,e]=we(t);return e},ve=async(t,e,n)=>{if(!e)return;const o=ie(t),s=(e==null?void 0:e.DeviceKey)??"",i=(e==null?void 0:e.DeviceGroupKey)??"",r=w(t),a=new h.CognitoIdentityProviderClient({region:r}),c=new se(o);try{c.generateHashDevice(i,s)}catch{return}const l={Salt:ae(c.saltToHashDevices),PasswordVerifier:ae(c.verifierDevices)};try{const d=c.randomPassword,g=new h.ConfirmDeviceCommand({AccessToken:n,DeviceKey:s,DeviceSecretVerifierConfig:l});return await a.send(g),{deviceKey:s,deviceGroupKey:i,randomPassword:d}}catch{return}},L=t=>{const e=O(),n=H(t),o=e.getItem(n.deviceKey),s=e.getItem(n.deviceGroupKey),i=e.getItem(n.randomPassword);return i?{deviceKey:o,deviceGroupKey:s,randomPassword:i}:void 0},re=()=>{const t=O();try{const e=H(),n=t.getItem(e.accessToken);if(!n)throw new C({name:"NoSessionFoundException",message:m.NoSessionFoundException});const o=B(n),s=t.getItem(e.idToken),i=s?B(s):void 0,r=t.getItem(e.refreshToken)??void 0,a=t.getItem(e.clockDrift)??"0",c=Number.parseInt(a),l=t.getItem(e.signInDetails),d={accessToken:o,idToken:i,refreshToken:r,deviceMetadata:L()??void 0,clockDrift:c,username:X(),signInDetails:void 0};return l&&(d.signInDetails=JSON.parse(l)),d}catch{return null}},Bt=t=>{if((t.message!=="Network error"||t.message!=="The Internet connection appears to be offline.")&&ee(),Y.dispatch("auth",{event:"tokenRefreshFailure",data:{err:t}}),t.name.startsWith("NotAuthorizedException"))return null;throw t},Ot=async({tokens:t,username:e})=>{var n;try{const o=t.refreshToken;if(!o)throw new C({name:"MissingRefreshTokenException",message:m.MissingRefreshTokenException});const s=t.deviceMetadata;if(!s)throw new C({name:"MissingDeviceMetadataException",message:m.MissingDeviceMetadataException});const i=(n=v.getConfig().Auth)==null?void 0:n.Cognito,{userPoolId:r,userPoolClientId:a}=i,c=w(r),l=new h.CognitoIdentityProviderClient({region:c}),d=new h.InitiateAuthCommand({ClientId:a,AuthFlow:"REFRESH_TOKEN_AUTH",AuthParameters:{REFRESH_TOKEN:o,DEVICE_KEY:s.deviceKey}}),{AuthenticationResult:g}=await l.send(d),f=B((g==null?void 0:g.AccessToken)??""),E=g!=null&&g.IdToken?B(g.IdToken):void 0,I=f.payload.iat;if(!I)throw new C({name:"iatNotFoundException",message:m.iatNotFoundException});const S=I*1e3-new Date().getTime();return{accessToken:f,idToken:E,clockDrift:S,refreshToken:t.refreshToken,username:e}}catch(o){return Bt(o)}},he=(t,e)=>Date.now()+e>t,k=async t=>{var r,a,c,l;let e=re();const n=X();if(e===null)return null;const o=e!=null&&e.idToken?he((((a=(r=e.idToken)==null?void 0:r.payload)==null?void 0:a.exp)??0)*1e3,e.clockDrift??0):!0,s=e!=null&&e.accessToken?he((((l=(c=e.accessToken)==null?void 0:c.payload)==null?void 0:l.exp)??0)*1e3,e.clockDrift??0):!0;return((t==null?void 0:t.forceRefresh)||o||s)&&(e=await Ot({tokens:e,username:n}),e===null)?null:{accessToken:e==null?void 0:e.accessToken,idToken:e==null?void 0:e.idToken,signInDetails:e==null?void 0:e.signInDetails}},ye=async()=>{var i;const t=await k({forceRefresh:!1});R(t);const{"cognito:username":e,sub:n}=((i=t.idToken)==null?void 0:i.payload)??{},o={username:e,userId:n},s=t.signInDetails;return s&&(o.signInDetails=s),o},J=t=>typeof t=="string"&&t.trim().length>0,m={InvalidConfigException:`
    Invalid or missing AWS Cognito configuration.

    This most likely occurred due to:
      1. EasyAuth.configure was not called before calling the method.

         EasyAuth.configure({
           Auth: {
             Cognito: {
               userPoolId: "your_user_pool_id",
               clientId: "your_client_id",
             }
           }
         });

         // ...

      2. The configuration object is missing 'userPoolId' or 'userPoolClientId'.
      3. The configuration object is not an object.`,UserAlreadyAuthenticatedException:"User is already authenticated.",EmptyChangePasswordException:"previousPassword and proposedPassword are required to change password.",EmptyUsernameException:"Username cannot be empty.",EmptyPasswordException:"Password cannot be empty.",EmptySignUpUsernameException:"Username is required to sign up.",EmptySignUpPasswordException:"Password is required to sign up.",EmptyResendSignUpCodeUsernameException:"Username is required to resend sign up code.",EmptyConfirmSignUpUsernameException:"Username is required to confirm sign up.",EmptyConfirmSignUpCodeException:"Code is required to confirm sign up.",EmptyUserIdForSRPException:"USER_ID_FOR_SRP was not found in challengeParameters.",InvalidUserPoolIdException:"Invalid user pool id provided.",MissingChallengeNameException:"Challenge name is missing from the authentication response.",MissingChallengeParametersException:"Challenge parameters are missing from the authentication response.",MissingSecretCodeException:"SecretCode is missing from the AssociateSoftwareTokenCommand.",InvalidAuthTokensException:"Invalid authentication tokens.",InvalidChallengeResponseException:`
    You provided an invalid challenge response.

    This most likely occurred due to:
      1. The challenge response was not provied.
      2. The challenge response was an empty string.
      3. The challenge response was not a string.`,SignInException:`
    An error occurred during the sign in process.

    This most likely occurred due to:
      1. signIn was not called before confirmSignIn.
      2. signIn threw an exception.
      3. page was refreshed during the sign in flow.`,InvalidMFASetupTypeException:"Invalid MFA setup type.",NoAccessTokenException:"No access token was found in the authentication result.",InvalidJWTTokenException:"Invalid JWT token provided, could not decode token.",InvalidJWTTokenPayloadException:"Invalid JWT payload",DeviceMetadataException:"'deviceKey', 'deviceGroupKey' or 'randomPassword' not found in local storage during the sign-in process..",UserUnauthenticatedException:"User needs to be authenticated to call this API.",iatNotFoundException:"iat not found in access token.",MissingRefreshTokenException:"Unable to refresh tokens: refresh token not provided.",MissingDeviceMetadataException:"Unable to refresh tokens: device metadata not provided.",ClientSignOutErrorException:"An error occurred during the client sign out process.",GlobalSignOutErrorException:"An error occurred during the global sign out process.",EmptyVerifyTOTPCodeException:"Code cannot be empty.",InvalidSameSiteValueException:'The sameSite value of cookieStorage must be "lax", "strict" or "none".',SameSiteNoneRequiresSequreException:"sameSite = None requires the Secure attribute in latest browser versions."},D=(t,e,n)=>{if(!t)throw new C({name:e,message:n})},Vt=async()=>{let t=null;try{t=await ye()}catch{}if(t&&t.userId&&t.username)throw new C({name:"UserAlreadyAuthenticatedException",message:m.UserAlreadyAuthenticatedException})};function Kt(t){if(!((t!=null&&t.accessToken||t!=null&&t.idToken)&&(t!=null&&t.refreshToken)))throw new C({name:"UserUnauthenticatedException",message:m.UserUnauthenticatedException})}function Ae(t){if(!(!!t&&J(t.deviceKey)&&J(t.deviceGroupKey)&&J(t.randomPassword)))throw new C({name:"DeviceMetadataException",message:m.DeviceMetadataException})}function R(t){const e=t==null?void 0:t.accessToken;if(!(e&&e.payload&&e.toString()))throw new C({name:"UserUnauthenticatedException",message:m.UserUnauthenticatedException})}class $t{constructor(e={}){p(this,"path");p(this,"domain");p(this,"expires");p(this,"secure");p(this,"sameSite");const{path:n,domain:o,expires:s,secure:i,sameSite:r}=e;if(this.path=n||"/",this.domain=o,this.expires=Object.prototype.hasOwnProperty.call(e,"expires")?s:365,this.secure=Object.prototype.hasOwnProperty.call(e,"secure")?i:!0,!!Object.prototype.hasOwnProperty.call(e,"sameSite")){if(!r||!["strict","lax","none"].includes(r))throw new C({name:"InvalidSameSiteValueException",message:m.InvalidSameSiteValueException});if(r==="none"&&!this.secure)throw new C({name:"SameSiteNoneRequiresSequreException",message:m.SameSiteNoneRequiresSequreException});this.sameSite=r}}getItem(e){return W.get(e)??null}setItem(e,n){W.set(e,n,this.getData())}removeItem(e){W.remove(e,this.getData())}clear(){const e=W.get();Object.keys(e).forEach(n=>this.removeItem(n))}getData(){return{path:this.path,domain:this.domain,expires:this.expires,secure:this.secure,...this.sameSite&&{sameSite:this.sameSite}}}}class Wt{constructor(){p(this,"resourcesConfig",{});p(this,"keyValueStorage",new fe);p(this,"getConfig",()=>{if(Object.keys(this.resourcesConfig).length===0)throw new C({name:"InvalidConfigException",message:m.InvalidConfigException});return this.validateConfig(this.resourcesConfig),this.resourcesConfig});p(this,"configure",e=>{this.validateConfig(e),this.resourcesConfig=e})}validateConfig(e){var o;const n=(o=e.Auth)==null?void 0:o.Cognito;if(!(n!=null&&n.userPoolId)||!(n!=null&&n.userPoolClientId))throw new C({name:"InvalidConfigException",message:m.InvalidConfigException})}setKeyValueStorage(e){this.keyValueStorage=e}}const v=new Wt,Ie=async t=>{const e=await k(t);R(e);const n=e.accessToken.payload.sub;return{tokens:e,sub:n}},Pe=()=>({username:"",challengeName:void 0,signInSession:void 0,signInDetails:void 0}),Ht=(t,e)=>{switch(e.type){case"SET_CHALLENGE_NAME":return{...t,challengeName:e.value};case"SET_SIGN_IN_SESSION":return{...t,signInSession:e.value};case"SET_USERNAME":return{...t,username:e.value};case"SET_SIGN_IN_STATE":return{...e.value};case"SET_INITIAL_STATE":return Pe();default:return t}},Gt=t=>{const e=Pe();let n=t(e,{type:"SET_INITIAL_STATE"});return{getState:()=>n,dispatch:o=>{n=t(n,o)}}},De=t=>{M.dispatch({type:"SET_SIGN_IN_STATE",value:t})},Ue=()=>{M.dispatch({type:"SET_INITIAL_STATE"})},M=Gt(Ht),Lt=t=>{const{dispatch:e}=M;e({type:"SET_USERNAME",value:t})},qt=t=>M.getState().username??t,Zt=t=>{if(t==="PasswordResetRequiredException")return{isSignedIn:!1,nextStep:{signInStep:"RESET_PASSWORD"}}},xe=t=>{if(t==="SMS_MFA")return"SMS";if(t==="SOFTWARE_TOKEN_MFA")return"TOTP"},Re=t=>{if(t)return t.map(xe).filter(Boolean)},Jt=t=>t?JSON.parse(t):[],jt=(t,e)=>{const{MFAS_CAN_SETUP:n}=t,o=Jt(n),s=Re(o);return s==null?void 0:s.includes(e)},zt=(t,e)=>({sharedSecret:t,getSetupUri:(n,o)=>`otpauth://totp/${n}:${o??e}?secret=${t}&issuer=${n}`}),Yt=async({username:t,client:e,srp:n,challengeParameters:o,session:s,cognitoConfig:i})=>{const{userPoolClientId:r}=i,a=L(t);Ae(a);const{deviceKey:c,deviceGroupKey:l,randomPassword:d}=a,{SRP_B:g,SALT:f,SECRET_BLOCK:E}=o,I=Se(),S=n.getPasswordAuthenticationKey(c,d,g,f),y=Ee(S,l,c,E,I),A={USERNAME:(o==null?void 0:o.USERNAME)??t,PASSWORD_CLAIM_SECRET_BLOCK:E,TIMESTAMP:I,PASSWORD_CLAIM_SIGNATURE:y,DEVICE_KEY:c},N=new h.RespondToAuthChallengeCommand({ChallengeName:"DEVICE_PASSWORD_VERIFIER",ChallengeResponses:A,ClientId:r,Session:s});return await e.send(N)},Qt=async(t,e)=>{const n=L(t);Ae(n);const{userPoolId:o,userPoolClientId:s}=e,i=w(o),r=new h.CognitoIdentityProviderClient({region:i}),a=new se(n.deviceGroupKey),c=a.calculateA(),l=new h.RespondToAuthChallengeCommand({ChallengeName:"DEVICE_SRP_AUTH",ChallengeResponses:{USERNAME:t,SRP_A:c,DEVICE_KEY:n.deviceKey},ClientId:s}),{ChallengeParameters:d,Session:g}=await r.send(l);if(!d)throw new C({name:"MissingChallengeParametersException",message:m.MissingChallengeParametersException});return await Yt({username:t,client:r,srp:a,challengeParameters:d,session:g,cognitoConfig:e})},Xt=async({username:t,password:e,cognitoConfig:n})=>{const{userPoolId:o,userPoolClientId:s}=n,i=ie(o),r=w(o),a=new h.CognitoIdentityProviderClient({region:r}),c=new se(i),l=c.calculateA(),d=new h.InitiateAuthCommand({AuthFlow:"USER_SRP_AUTH",AuthParameters:{USERNAME:t,SRP_A:l},ClientId:s}),{ChallengeName:g,ChallengeParameters:f,Session:E}=await a.send(d);if(!(f&&f.SRP_B&&f.SALT&&f.SECRET_BLOCK))throw new C({name:"MissingChallengeParametersException",message:m.MissingChallengeParametersException});const S=f.USERNAME??t;if(Lt(S),!g)throw new C({name:"MissingChallengeNameException",message:m.MissingChallengeNameException});const y=await en({challengeName:g,cognitoConfig:n,client:a,srp:c,password:e,challengeParameters:f,session:E});return y.ChallengeName==="DEVICE_SRP_AUTH"?Qt(S,n):y},en=async({challengeName:t,cognitoConfig:e,client:n,srp:o,password:s,challengeParameters:i,session:r})=>{const{userPoolId:a,userPoolClientId:c}=e,l=ie(a),{SRP_B:d,SALT:g,SECRET_BLOCK:f}=i,E=i.USER_ID_FOR_SRP;if(!E)throw new C({name:"EmptyUserIdForSRPException",message:m.EmptyUserIdForSRPException});const I=Se(),S=o.getPasswordAuthenticationKey(E,s,d,g),y=Ee(S,l,E,f,I),A={USERNAME:E,PASSWORD_CLAIM_SECRET_BLOCK:f,TIMESTAMP:I,PASSWORD_CLAIM_SIGNATURE:y},N=L(E);N&&N.deviceKey&&(A.DEVICE_KEY=N.deviceKey);const Fe=new h.RespondToAuthChallengeCommand({ChallengeName:t,ChallengeResponses:A,ClientId:c,Session:r});return await n.send(Fe)},tn=t=>{if(!t)return[];const e="userAttributes.";let n;try{n=JSON.parse(t)}catch{return[]}return Array.isArray(n)?n.map(o=>o.startsWith(e)?o.replace(e,""):o):[]},nn=t=>({isSignedIn:!1,nextStep:{signInStep:"CONFIRM_SIGN_IN_WITH_NEW_PASSWORD_REQUIRED",missingAttributes:tn(t.requiredAttributes)}}),on=async t=>{var g;const{signInSession:e,username:n}=M.getState(),o=(g=v.getConfig().Auth)==null?void 0:g.Cognito,{userPoolId:s}=o,i=w(s);if(!jt(t,"TOTP"))throw new C({name:"SignInException",message:m.InvalidMFASetupTypeException+": TOTP"});const a=new h.CognitoIdentityProviderClient({region:i}),c=new h.AssociateSoftwareTokenCommand({Session:e}),{SecretCode:l,Session:d}=await a.send(c);if(!l)throw new C({name:"MissingSecretCodeException",message:m.MissingSecretCodeException});return M.dispatch({type:"SET_SIGN_IN_SESSION",value:d}),{isSignedIn:!1,nextStep:{signInStep:"CONTINUE_SIGN_IN_WITH_TOTP_SETUP",totpSetupDetails:zt(l,n)}}},sn=()=>({isSignedIn:!1,nextStep:{signInStep:"CONFIRM_SIGN_IN_WITH_TOTP_CODE"}}),rn={NEW_PASSWORD_REQUIRED:nn,MFA_SETUP:on,SOFTWARE_TOKEN_MFA:sn},Ne=(t,e)=>{const n=rn[t??""];if(n)return n(e);throw new C({name:"ChallengeNotHandledException",message:`No next step for challenge: ${t}`})},an=async t=>{const{username:e,password:n}=t,o={loginId:e,authFlowType:"USER_SRP_AUTH"};D(!!e,"EmptyUsernameException",m.EmptyUsernameException),D(!!n,"EmptyPasswordException",m.EmptyPasswordException);try{const s=v.getConfig().Auth.Cognito,{ChallengeName:i,ChallengeParameters:r,AuthenticationResult:a,Session:c}=await Xt({username:e,password:n,cognitoConfig:s}),l=qt(e);if(De({signInSession:c,username:l,challengeName:i,signInDetails:o}),a)return Ue(),Ce({username:l,authenticationResult:a,newDeviceMetadata:await ve(s.userPoolId,a.NewDeviceMetadata,a.AccessToken),signInDetails:o}),Y.dispatch("auth",{event:"signedIn",data:await Ie()}),{isSignedIn:!0,nextStep:{signInStep:"DONE"}};if(!i)throw new C({name:"MissingChallengeNameException",message:m.MissingChallengeNameException});return Ne(i,r)}catch(s){const i=Zt(s.name);if(i)return i;throw s}},cn=async t=>{var n;const e=(n=t.options)==null?void 0:n.authFlowType;switch(await Vt(),e){default:return an(t)}},ln=async t=>{var o;const e=(o=v.getConfig().Auth)==null?void 0:o.Cognito;(t==null?void 0:t.isGlobal)?await un(e):await dn(e),ee(),Y.dispatch("auth",{event:"signedOut"})},dn=async t=>{try{const e=re();if(Kt(e),!ke(e.accessToken))return;const{userPoolId:o,userPoolClientId:s}=t,i=w(o),r=new h.CognitoIdentityProviderClient({region:i}),a=new h.RevokeTokenCommand({ClientId:s,Token:e.refreshToken});await r.send(a)}catch{console.log(m.ClientSignOutErrorException)}},un=async t=>{try{const e=re();if(R(e),!ke(e.accessToken))return;const{userPoolId:o}=t,s=w(o),i=new h.CognitoIdentityProviderClient({region:s}),r=new h.GlobalSignOutCommand({AccessToken:e.accessToken.toString()});await i.send(r)}catch{console.log(m.GlobalSignOutErrorException)}},ke=t=>{var e;return!!((e=t==null?void 0:t.payload)!=null&&e.origin_jti)},hn=t=>{const e="userAttributes.";return t?Object.entries(t).reduce((n,[o,s])=>(s&&(n[`${e}${o}`]=s),n),{}):{}},gn=async({username:t,signInSession:e,challengeResponse:n,cognitoConfig:o,options:s})=>{const{userPoolId:i,userPoolClientId:r}=o,a=w(i),c=new h.CognitoIdentityProviderClient({region:a}),l=new h.RespondToAuthChallengeCommand({ChallengeName:"NEW_PASSWORD_REQUIRED",ChallengeResponses:{...hn(s==null?void 0:s.requiredAttributes),NEW_PASSWORD:n,USERNAME:t},ClientId:r,Session:e});return await c.send(l)},mn=async({username:t,signInSession:e,challengeResponse:n,cognitoConfig:o})=>{const{userPoolId:s,userPoolClientId:i}=o,r=w(s),a=new h.CognitoIdentityProviderClient({region:r}),c=new h.VerifySoftwareTokenCommand({UserCode:n,Session:e}),{Session:l}=await a.send(c);M.dispatch({type:"SET_SIGN_IN_SESSION",value:l});const d=new h.RespondToAuthChallengeCommand({ChallengeName:"MFA_SETUP",ChallengeResponses:{USERNAME:t},ClientId:i,Session:l});return a.send(d)},fn=async({username:t,signInSession:e,challengeResponse:n,cognitoConfig:o})=>{const{userPoolId:s,userPoolClientId:i}=o,r=w(s),a=new h.CognitoIdentityProviderClient({region:r}),c=new h.RespondToAuthChallengeCommand({ChallengeName:"SOFTWARE_TOKEN_MFA",ChallengeResponses:{USERNAME:t,SOFTWARE_TOKEN_MFA_CODE:n},ClientId:i,Session:e});return a.send(c)},pn={NEW_PASSWORD_REQUIRED:gn,MFA_SETUP:mn,SOFTWARE_TOKEN_MFA:fn},Cn=async({username:t,challengeName:e,signInSession:n,challengeResponse:o,cognitoConfig:s,options:i})=>{const r=pn[e];if(!r)throw new C({name:"UnknownChallengeException",message:`Unknown challenge: ${e}`});return await r({username:t,signInSession:n,challengeResponse:o,cognitoConfig:s,options:i})},Sn=async t=>{const{challengeResponse:e,options:n}=t,{username:o,challengeName:s,signInSession:i,signInDetails:r}=M.getState();if(D(!!e&&typeof e=="string","InvalidChallengeResponseException",m.InvalidChallengeResponseException),D(!!o&&!!i,"SignInException",m.SignInException),!s)throw new C({name:"MissingChallengeNameException",message:m.MissingChallengeNameException});const a=v.getConfig().Auth.Cognito,{ChallengeName:c,ChallengeParameters:l,AuthenticationResult:d,Session:g}=await Cn({username:o,challengeName:s,signInSession:i,challengeResponse:e,cognitoConfig:a,options:n});return De({username:o,challengeName:c,signInSession:g,signInDetails:r}),d?(Ue(),Ce({username:o,authenticationResult:d,newDeviceMetadata:await ve(a.userPoolId,d.NewDeviceMetadata,d.AccessToken),signInDetails:r}),{isSignedIn:!0,nextStep:{signInStep:"DONE"}}):Ne(c,l)},En=async t=>{var d;const e=(d=v.getConfig().Auth)==null?void 0:d.Cognito,{userPoolId:n,userPoolClientId:o}=e,{username:s,newPassword:i,confirmationCode:r}=t;D(!!s,"EmptyConfirmResetPasswordUsernameException",m.EmptyConfirmResetPasswordUsernameException),D(!!i,"EmptyConfirmResetPasswordNewPasswordException",m.EmptyConfirmResetPasswordNewPasswordException),D(!!r,"EmptyConfirmResetPasswordConfirmationCodeException",m.EmptyConfirmResetPasswordConfirmationCodeException);const a=w(n),c=new h.CognitoIdentityProviderClient({region:a}),l=new h.ConfirmForgotPasswordCommand({Username:s,ConfirmationCode:r,Password:i,ClientId:o});await c.send(l)},Tn=async t=>{var d;const e=(d=v.getConfig().Auth)==null?void 0:d.Cognito,{userPoolId:n,userPoolClientId:o}=e,s=t.username;D(!!s,"EmptyResetPasswordUsernameException",m.EmptyResetPasswordUsernameException);const i=w(n),r=new h.CognitoIdentityProviderClient({region:i}),a=new h.ForgotPasswordCommand({Username:s,ClientId:o}),l=(await r.send(a)).CodeDeliveryDetails;return{isPasswordReset:!1,nextStep:{resetPasswordStep:"CONFIRM_RESET_PASSWORD_WITH_CODE",codeDeliveryDetails:{deliveryMedium:l==null?void 0:l.DeliveryMedium,destination:l==null?void 0:l.Destination,attributeName:l==null?void 0:l.AttributeName}}}},wn=async t=>{const{previousPassword:e,proposedPassword:n}=t,o=await k();R(o),D(!!e&&!!n,"EmptyChangePasswordException",m.EmptyChangePasswordException);const s=v.getConfig().Auth.Cognito,{userPoolId:i}=s,r=w(i),a=new h.CognitoIdentityProviderClient({region:r}),c=new h.ChangePasswordCommand({PreviousPassword:e,ProposedPassword:n,AccessToken:o.accessToken.toString()});await a.send(c)},vn=async()=>{const t=await k();R(t);const e=v.getConfig().Auth.Cognito,{userPoolId:n}=e,o=w(n),s=new h.CognitoIdentityProviderClient({region:o}),i=new h.GetUserCommand({AccessToken:t.accessToken.toString()}),{PreferredMfaSetting:r,UserMFASettingList:a}=await s.send(i);return{preferredMFASetting:xe(r),userMFASettingList:Re(a)}},ge=t=>{if(t==="ENABLED")return{Enabled:!0};if(t==="DISABLED")return{Enabled:!1};if(t==="PREFERRED")return{Enabled:!0,PreferredMfa:!0};if(t==="NOT_PREFERRED")return{Enabled:!0,PreferredMfa:!1}},yn=async t=>{const{sms:e,totp:n}=t,o=await k();R(o);const s=v.getConfig().Auth.Cognito,{userPoolId:i}=s,r=w(i),a=new h.CognitoIdentityProviderClient({region:r}),c=new h.SetUserMFAPreferenceCommand({AccessToken:o.accessToken.toString(),SoftwareTokenMfaSettings:ge(n),SMSMfaSettings:ge(e)});await a.send(c)},An=60,In=async()=>{const t=await k();R(t);const e=v.getConfig().Auth.Cognito,{userPoolId:n}=e,o=w(n),s=new h.CognitoIdentityProviderClient({region:o}),i=new h.ListDevicesCommand({AccessToken:t.accessToken.toString(),Limit:An});return await s.send(i)},Pn=t=>{const e={};return t==null||t.map(({Name:n,Value:o})=>{n&&(e[n]=o)}),e},Dn=async()=>{const t=await k();R(t);const e=v.getConfig().Auth.Cognito,{userPoolId:n}=e,o=w(n),s=new h.CognitoIdentityProviderClient({region:o}),i=new h.GetUserCommand({AccessToken:t.accessToken.toString()}),{UserAttributes:r}=await s.send(i);return Pn(r)},Un=async t=>{const{code:e,options:n}=t,o=await k();R(o),D(!!e,"EmptyVerifyTOTPCodeException",m.EmptyVerifyTOTPCodeException);const s=v.getConfig().Auth.Cognito,{userPoolId:i}=s,r=w(i),a=new h.CognitoIdentityProviderClient({region:r}),c=new h.VerifySoftwareTokenCommand({AccessToken:o.accessToken.toString(),UserCode:e,FriendlyDeviceName:n==null?void 0:n.deviceName}),l=await a.send(c);return{status:l.Status,session:l.Session}},xn=t=>Object.entries(t).map(([e,n])=>({Name:e,Value:n})),Rn=async t=>{const{username:e,password:n,options:o}=t;D(!!e,"EmptySignUpUsernameException",m.EmptySignUpUsernameException),D(!!n,"EmptySignUpPasswordException",m.EmptySignUpPasswordException);const s=v.getConfig().Auth.Cognito,{userPoolId:i,userPoolClientId:r}=s,a=w(i),c=new h.CognitoIdentityProviderClient({region:a}),l=new h.SignUpCommand({ClientId:r,Username:e,Password:n,UserAttributes:(o==null?void 0:o.userAttributes)&&xn(o==null?void 0:o.userAttributes)}),{UserConfirmed:d,CodeDeliveryDetails:g,UserSub:f}=await c.send(l);return d?{isSignUpComplete:!0,nextStep:{signUpStep:"DONE"},userId:f}:{isSignUpComplete:!1,nextStep:{signUpStep:"CONFIRM_SIGN_UP",codeDeliveryDetails:{deliveryMedium:g==null?void 0:g.DeliveryMedium,destination:g==null?void 0:g.Destination,attributeName:g==null?void 0:g.AttributeName}},userId:f}},Nn=async t=>{const{username:e,confirmationCode:n,options:o}=t;D(!!e,"EmptyConfirmSignUpUsernameException",m.EmptyConfirmSignUpUsernameException),D(!!n,"EmptyConfirmSignUpCodeException",m.EmptyConfirmSignUpCodeException);const s=v.getConfig().Auth.Cognito,{userPoolId:i,userPoolClientId:r}=s,a=w(i),c=new h.CognitoIdentityProviderClient({region:a}),l=new h.ConfirmSignUpCommand({ClientId:r,Username:e,ConfirmationCode:n,ForceAliasCreation:o==null?void 0:o.forceAliasCreation});return await c.send(l),{isSignUpComplete:!0,nextStep:{signUpStep:"DONE"}}},kn=async t=>{const{username:e}=t;D(!!e,"EmptyResendSignUpCodeUsernameException",m.EmptyResendSignUpCodeUsernameException);const n=v.getConfig().Auth.Cognito,{userPoolId:o,userPoolClientId:s}=n,i=w(o),r=new h.CognitoIdentityProviderClient({region:i}),a=new h.ResendConfirmationCodeCommand({Username:e,ClientId:s}),{CodeDeliveryDetails:c}=await r.send(a);return{destination:c==null?void 0:c.Destination,deliveryMedium:c==null?void 0:c.DeliveryMedium,attributeName:c==null?void 0:c.AttributeName}},Fn=async()=>{const t=await k();R(t);const e=v.getConfig().Auth.Cognito,{userPoolId:n}=e,o=w(n),s=new h.CognitoIdentityProviderClient({region:o}),i=new h.DeleteUserCommand({AccessToken:t.accessToken.toString()});await s.send(i)};exports.CookieStorage=$t;exports.DefaultStorage=fe;exports.EasyAuth=v;exports.InMemoryStorage=me;exports.confirmResetPassword=En;exports.confirmSignIn=Sn;exports.confirmSignUp=Nn;exports.deleteUser=Fn;exports.getCurrentSession=Ie;exports.getCurrentUser=ye;exports.getDevices=In;exports.getMFAPreference=vn;exports.getUserAttributes=Dn;exports.resendSignUpCode=kn;exports.resetPassword=Tn;exports.signIn=cn;exports.signOut=ln;exports.signUp=Rn;exports.updateMFAPreference=yn;exports.updatePassword=wn;exports.verifyTOTP=Un;
